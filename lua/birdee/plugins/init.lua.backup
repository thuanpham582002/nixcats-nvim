local MP = ...
local catUtils = require('nixCatsUtils')
local colorschemer = nixCats.extra('colorscheme') -- also schemes lualine
if not catUtils.isNixCats then
  colorschemer = 'onedark'
end
if colorschemer == 'onedark' then
  require('onedark').setup {
    -- Set a style preset. 'dark' is default.
    style = 'darker', -- dark, darker, cool, deep, warm, warmer, light
  }
  require('onedark').load()
elseif colorschemer == 'tokyonight' or colorschemer == 'tokyonight-day' then
  require('tokyonight').setup {
    -- Available styles: storm, moon, night, day
    style = colorschemer == 'tokyonight-day' and 'day' or 'storm',
    light_style = 'day', -- The theme is used when the background is set to light
    transparent = false, -- Enable this to disable setting the background color
    terminal_colors = true, -- Configure the colors used when opening a `:terminal` in Neovim
    styles = {
      -- Style to be applied to different syntax groups
      -- Value is any valid attr-list value for `:help nvim_set_hl`
      comments = { italic = true },
      keywords = { italic = true },
      functions = {},
      variables = {},
      -- Background styles. Can be "dark", "transparent" or "normal"
      sidebars = "dark", -- style for sidebars, see below
      floats = "dark", -- style for floating windows
    },
    sidebars = { "qf", "help" }, -- Set a darker background on sidebar-like windows
    day_brightness = 0.3, -- Adjusts the brightness of the colors of the **Day** style. Number between 0 and 1
    hide_inactive_statusline = false, -- Enabling this option, will hide inactive statuslines
    dim_inactive = false, -- dims inactive windows
    lualine_bold = false, -- When `true`, section headers in the lualine theme will be bold
  }
end
if colorschemer ~= "" then
  vim.cmd.colorscheme(colorschemer)
end

if nixCats('other') then
  vim.keymap.set('n', '<leader>rs', '<cmd>lua require("spectre").toggle()<CR>', {
    desc = "Toggle Spectre"
  })
  vim.keymap.set('n', '<leader>rw', '<cmd>lua require("spectre").open_visual({select_word=true})<CR>', {
    desc = "Search current word"
  })
  vim.keymap.set('v', '<leader>rw', '<esc><cmd>lua require("spectre").open_visual()<CR>', {
    desc = "Search current word"
  })
  vim.keymap.set('n', '<leader>rf', '<cmd>lua require("spectre").open_file_search({select_word=true})<CR>', {
    desc = "Search on current file"
  })
end
-- NOTE: This is already lazy. It doesnt require it until you use the keybinding
vim.keymap.set({ 'n', }, "<leader>cpc", function() require("color_picker").rgbPicker() end, { desc = "color_picker rgb" })
vim.keymap.set({ 'n', }, "<leader>cph", function() require("color_picker").hsvPicker() end, { desc = "color_picker hsv" })
vim.keymap.set({ 'n', }, "<leader>cps", function() require("color_picker").hslPicker() end, { desc = "color_picker hsl" })
vim.keymap.set({ 'n', }, "<leader>cpg", function() require("color_picker").rgbGradientPicker() end, { desc = "color_picker rgb gradient" })
vim.keymap.set({ 'n', }, "<leader>cpd", function() require("color_picker").hsvGradientPicker() end, { desc = "color_picker hsv gradient" })
vim.keymap.set({ 'n', }, "<leader>cpb", function() require("color_picker").hslGradientPicker() end, { desc = "color_picker hsl gradient"})

if nixCats('general') then
  -- No need to copy this inside `setup()`. Will be used automatically.
  require("mini.sessions").setup {
    -- Whether to read default session if Neovim opened without file arguments
    autoread = true,

    -- Whether to write currently read session before leaving it
    autowrite = true,

    -- Directory where global sessions are stored (use `''` to disable)
    directory = vim.fn.stdpath('data') .. "/sessions",

    -- File for local session (use `''` to disable)
    file = 'Session.vim',

    -- Whether to force possibly harmful actions (meaning depends on function)
    force = { read = false, write = true, delete = false },

    -- Hook functions for actions. Default `nil` means 'do nothing'.
    hooks = {
      -- Before successful action
      pre = { read = nil, write = nil, delete = nil },
      -- After successful action
      post = { read = nil, write = nil, delete = nil },
    },

    -- Whether to print session path after action
    verbose = { read = false, write = true, delete = true },
  }
  -- require(MP:relpath 'oil') -- Removed - using Snacks Explorer instead
end

return {
  { import = MP:relpath "snacks", },
  { import = MP:relpath "nestsitter", },
  { import = MP:relpath "blink", },
  { import = MP:relpath "conjure", },
  { import = MP:relpath "grapple", },
  { import = MP:relpath "lualine", },
  { import = MP:relpath "git", },
  { import = MP:relpath "image", },
  { import = MP:relpath "which-key", },
  { import = MP:relpath "AI", },
  { import = MP:relpath "ui", },
  { import = MP:relpath "lsp", },
  { import = MP:relpath "editing", },
  { import = MP:relpath "visual", },
  { import = MP:relpath "document", },
  -- Claude Code integration
  {
    'claudecode.nvim',
    for_cat = { cat = 'AI.claudecode', default = false },
    keys = {
      { '<leader>ac', '<cmd>ClaudeCode<cr>', desc = 'Toggle Claude Code terminal' },
      { '<leader>as', '<cmd>ClaudeCodeSend<cr>', mode = { 'n', 'v' }, desc = 'Send to Claude Code' },
      { '<leader>aa', '<cmd>ClaudeCodeDiffAccept<cr>', desc = 'Accept Claude Code diff' },
      { '<leader>ad', '<cmd>ClaudeCodeDiffDeny<cr>', desc = 'Deny Claude Code diff' },
    },
    cmd = {
      'ClaudeCode',
      'ClaudeCodeSend', 
      'ClaudeCodeDiffAccept',
      'ClaudeCodeDiffDeny'
    },
    after = function()
      vim.defer_fn(function()
        local ok, claudecode = pcall(require, 'claudecode')
        if ok then
          claudecode.setup({
            -- Plugin configuration options
            terminal = {
              snacks_win_opts = {
                bo = {
                  filetype = "claudecode", -- Custom filetype instead of snacks_terminal
                },
              },
            },
          })
        else
          vim.notify("Claude Code plugin loaded but setup failed", vim.log.levels.WARN)
        end
      end, 100)
    end,
  },
  {
    "treesj",
    for_cat = "general.core",
    cmd = { "TSJToggle" },
    keys = { { "<leader>Ft", ":TSJToggle<CR>", mode = { "n" }, desc = "treesj split/join" }, },
    after = function(_)
      local tsj = require('treesj')

      -- local langs = {--[[ configuration for languages ]]}

      tsj.setup({
        ---@type boolean Use default keymaps (<space>m - toggle, <space>j - join, <space>s - split)
        use_default_keymaps = false,
        ---@type boolean Node with syntax error will not be formatted
        check_syntax_error = true,
        ---If line after join will be longer than max value,
        ---@type number If line after join will be longer than max value, node will not be formatted
        max_join_length = 120,
        ---Cursor behavior:
        ---hold - cursor follows the node/place on which it was called
        ---start - cursor jumps to the first symbol of the node being formatted
        ---end - cursor jumps to the last symbol of the node being formatted
        ---@type 'hold'|'start'|'end'
        cursor_behavior = 'hold',
        ---@type boolean Notify about possible problems or not
        notify = true,
        ---@type boolean Use `dot` for repeat action
        dot_repeat = true,
        ---@type nil|function Callback for treesj error handler. func (err_text, level, ...other_text)
        on_error = nil,
        ---@type table Presets for languages
        -- langs = langs, -- See the default presets in lua/treesj/langs
      })
    end,
  },
  {
    "typst-preview.nvim",
    ft = "typst",
    after = function()
      require 'typst-preview'.setup {
        -- Setting this true will enable logging debug information to
        -- `vim.fn.stdpath 'data' .. '/typst-preview/log.txt'`
        debug = false,
        -- Custom format string to open the output link provided with %s
        -- Example: open_cmd = 'firefox %s -P typst-preview --class typst-preview'
        open_cmd = nil,
        -- Custom port to open the preview server. Default is random.
        -- Example: port = 8000
        port = nil,
        -- Setting this to 'always' will invert black and white in the preview
        -- Setting this to 'auto' will invert depending if the browser has enable
        -- dark mode
        -- Setting this to '{"rest": "<option>","image": "<option>"}' will apply
        -- your choice of color inversion to images and everything else
        -- separately.
        invert_colors = 'never',
        -- Whether the preview will follow the cursor in the source file
        follow_cursor = true,
        -- Provide the path to binaries for dependencies.
        -- Setting this will skip the download of the binary by the plugin.
        -- Warning: Be aware that your version might be older than the one
        -- required.
        dependencies_bin = {
          tinymist = 'tinymist',
          websocat = 'websocat'
        },
        -- A list of extra arguments (or nil) to be passed to previewer.
        -- For example, extra_args = { "--input=ver=draft", "--ignore-system-fonts" }
        extra_args = nil,
        -- This function will be called to determine the root of the typst project
        get_root = function(path_of_main_file)
          local root = os.getenv 'TYPST_ROOT'
          if root then
            return root
          end
          return vim.fn.fnamemodify(path_of_main_file, ':p:h')
        end,
        -- This function will be called to determine the main file of the typst
        -- project.
        get_main_file = function(path_of_buffer)
          return path_of_buffer
        end,
      }
    end,
  },
  {
    "markdown-preview.nvim",
    for_cat = "markdown",
    cmd = { "MarkdownPreview", "MarkdownPreviewStop", "MarkdownPreviewToggle", },
    ft = "markdown",
    keys = {
      {"<leader>mp", "<cmd>MarkdownPreview <CR>", mode = {"n"}, noremap = true, desc = "markdown preview"},
      {"<leader>ms", "<cmd>MarkdownPreviewStop <CR>", mode = {"n"}, noremap = true, desc = "markdown preview stop"},
      {"<leader>mt", "<cmd>MarkdownPreviewToggle <CR>", mode = {"n"}, noremap = true, desc = "markdown preview toggle"},
    },
    before = function(_)
      vim.g.mkdp_auto_close = 0
    end,
  },
  {
    "render-markdown.nvim",
    for_cat = "markdown",
    ft = "markdown",
    after = function(_)
      require('render-markdown').setup({})
    end,
  },
  {
    "otter.nvim",
    for_cat = "otter",
    -- event = "DeferredUIEnter",
    on_require = { "otter" },
    -- ft = { "markdown", "norg", "templ", "nix", "javascript", "html", "typescript", },
    after = function(_)
      local otter = require 'otter'
      otter.setup {
        lsp = {
          -- `:h events` that cause the diagnostics to update. Set to:
          -- { "BufWritePost", "InsertLeave", "TextChanged" } for less performant
          -- but more instant diagnostic updates
          diagnostic_update_events = { "BufWritePost" },
          -- function to find the root dir where the otter-ls is started
          root_dir = function(_, bufnr)
            return vim.fs.root(bufnr or 0, {
              ".git",
              "_quarto.yml",
              "package.json",
            }) or vim.fn.getcwd(0)
          end,
        },
        buffers = {
          -- if set to true, the filetype of the otterbuffers will be set.
          -- otherwise only the autocommand of lspconfig that attaches
          -- the language server will be executed without setting the filetype
          set_filetype = false,
          -- write <path>.otter.<embedded language extension> files
          -- to disk on save of main buffer.
          -- usefule for some linters that require actual files
          -- otter files are deleted on quit or main buffer close
          write_to_disk = false,
        },
        verbose = {          -- set to false to disable all verbose messages
          no_code_found = false, -- warn if otter.activate is called, but no injected code was found
        },
        strip_wrapping_quote_characters = { "'", '"', "`" },
        -- otter may not work the way you expect when entire code blocks are indented (eg. in Org files)
        -- When true, otter handles these cases fully.
        handle_leading_whitespace = false,
      }
    end,
  },
  {
    "dial.nvim",
    for_cat = "general.core",
    keys = {
      { "<C-a>", function() require("dial.map").manipulate("increment", "normal") end, mode = "n", desc = "Increment" },
      { "<C-x>", function() require("dial.map").manipulate("decrement", "normal") end, mode = "n", desc = "Decrement" },
      { "<C-x>", function() require("dial.map").manipulate("decrement", "normal") end, mode = "n", desc = "Decrement" },
      { "g<C-a>", function() require("dial.map").manipulate("increment", "gnormal") end, mode = "n", desc = "Increment" },
      { "g<C-x>", function() require("dial.map").manipulate("decrement", "gnormal") end, mode = "n", desc = "Decrement" },
      { "<C-a>", function() require("dial.map").manipulate("increment", "visual") end, mode = "v", desc = "Increment" },
      { "<C-x>", function() require("dial.map").manipulate("decrement", "visual") end, mode = "v", desc = "Increment" },
      { "g<C-a>", function() require("dial.map").manipulate("increment", "gvisual") end, mode = "v", desc = "Increment" },
      { "g<C-x>", function() require("dial.map").manipulate("decrement", "gvisual") end, mode = "v", desc = "Increment" },
    },
    after = function(_)
      local augend = require("dial.augend")
      require("dial.config").augends:register_group{
        default = {
          augend.integer.alias.decimal,
          augend.integer.alias.hex,
          augend.date.alias["%Y/%m/%d"],
          augend.date.alias["%Y-%m-%d"],
          augend.date.alias["%m/%d"],
          augend.date.alias["%H:%M"],
          augend.constant.alias.ja_weekday_full,
          augend.constant.alias.bool,
          augend.semver.alias.semver,
        },
      }
    end
  },
  {
    "undotree",
    for_cat = "general.core",
    cmd = { "UndotreeToggle", "UndotreeHide", "UndotreeShow", "UndotreeFocus", "UndotreePersistUndo", },
    keys = { { "<leader>U", "<cmd>UndotreeToggle<CR>", mode = { "n" }, desc = "Undo Tree" }, },
    before = function(_)
      vim.g.undotree_WindowLayout = 1
      vim.g.undotree_SplitWidth = 40
    end,
  },
  {
    "todo-comments.nvim",
    for_cat = "other",
    event = "DeferredUIEnter",
    after = function(_)
      require("todo-comments").setup({ signs = false })
    end,
  },
  {
    "visual-whitespace",
    for_cat = "other",
    event = "DeferredUIEnter",
    after = function(_)
      require('visual-whitespace').setup({
        highlight = { link = 'Visual' },
        space_char = 'Â·',
        tab_char = 'â†’',
        nl_char = 'â†²'
      })
    end,
  },
  {
    "vim-startuptime",
    for_cat = "other",
    cmd = { "StartupTime" },
    before = function(_)
      vim.g.startuptime_event_width = 0
      vim.g.startuptime_tries = 10
      vim.g.startuptime_exe_path = nixCats.packageBinPath
    end,
  },
  {
    "nvim-surround",
    for_cat = "general.core",
    event = "DeferredUIEnter",
    -- keys = "",
    after = function(_)
      require('nvim-surround').setup()
    end,
  },
  {
    "eyeliner.nvim",
    for_cat = "other",
    event = "DeferredUIEnter",
    -- keys = "",
    after = function(_)
      -- Highlights unique characters for f/F and t/T motions
      require('eyeliner').setup {
        highlight_on_key = true, -- show highlights only after key press
        dim = true,          -- dim all other characters
      }
    end,
  },
  {
    "vim-dadbod",
    for_cat = "SQL",
    cmd = { "DB", "DBUI", "DBUIAddConnection", "DBUIClose",
      "DBUIToggle", "DBUIFindBuffer", "DBUILastQueryInfo", "DBUIRenameBuffer", },
    load = function(name)
      require("lzextras").loaders.multi {
        name,
        "vim-dadbod-ui",
      }
      require("lzextras").loaders.with_after("vim-dadbod-completion")
    end,
    after = function(_)
    end,
  },
  {
    "hlargs",
    for_cat = "other",
    event = "DeferredUIEnter",
    after = function(_)
      require('hlargs').setup({
        color = '#32a88f',
      })
      vim.cmd([[hi clear @lsp.type.parameter]])
      vim.cmd([[hi link @lsp.type.parameter Hlargs]])
    end,
  },
  {
    "vim-sleuth",
    for_cat = "general.core",
    event = "DeferredUIEnter",
  },
  {
    "nvim-highlight-colors",
    for_cat = "other",
    event = "DeferredUIEnter",
    -- ft = "",
    after = function(_)
      require("nvim-highlight-colors").setup {
        ---Render style
        ---@usage 'background'|'foreground'|'virtual'
        render = 'virtual',

        ---Set virtual symbol (requires render to be set to 'virtual')
        virtual_symbol = 'â– ',

        ---Highlight named colors, e.g. 'green'
        enable_named_colors = true,

        ---Highlight tailwind colors, e.g. 'bg-blue-500'
        enable_tailwind = true,

        ---Set custom colors
        ---Label must be properly escaped with '%' to adhere to `string.gmatch`
        --- :help string.gmatch
        custom_colors = {
          { label = '%-%-theme%-primary%-color',   color = '#0f1219' },
          { label = '%-%-theme%-secondary%-color', color = '#5a5d64' },
        }
      }
    end,
  },
  {
    "diffview.nvim",
    for_cat = "general.core",
    on_require = { "diffview" },
    after = function()
      require('diffview').setup({
        -- Enhanced diff viewing configuration
        diff_binaries = false,
        enhanced_diff_hl = true,
        git_cmd = { "git" },
        
        -- File panel configuration
        file_panel = {
          listing_style = "tree",
          tree_options = {
            flatten_dirs = true,
            folder_statuses = "only_folded",
          },
          win_config = {
            position = "left",
            width = 35,
            win_opts = {}
          },
        },
        
        -- File history panel
        file_history_panel = {
          log_options = {
            git = {
              single_file = {
                diff_merges = "combined",
              },
              multi_file = {
                diff_merges = "first-parent",
              },
            },
          },
          win_config = {
            position = "bottom",
            height = 16,
            win_opts = {}
          },
        },
        
        -- Commit log panel
        commit_log_panel = {
          win_config = {
            position = "bottom",
            height = 16,
            win_opts = {}
          }
        },
        
        -- Default arguments
        default_args = {
          DiffviewOpen = {},
          DiffviewFileHistory = {},
        },
        
        -- Hooks for custom behavior
        hooks = {
          diff_buf_read = function(bufnr)
            vim.opt_local.wrap = false
            vim.opt_local.list = false
            vim.opt_local.colorcolumn = "80"
          end,
        },
        
        -- View configuration
        view = {
          default = {
            layout = "diff2_horizontal",
            winbar_info = true,
          },
          merge_tool = {
            layout = "diff3_horizontal",
            disable_diagnostics = true,
            winbar_info = true,
          },
          file_history = {
            layout = "diff2_horizontal",
            winbar_info = true,
          },
        },
      })
    end,
    
    -- Command-based loading
    cmd = {
      "DiffviewOpen",
      "DiffviewClose",
      "DiffviewToggleFiles",
      "DiffviewFocusFiles",
      "DiffviewRefresh",
      "DiffviewFileHistory",
    },
    
    -- Key mappings
    keys = {
      {
        "<leader>gd",
        "<cmd>DiffviewOpen<cr>",
        desc = "Open Diffview",
      },
      {
        "<leader>gD",
        "<cmd>DiffviewClose<cr>",
        desc = "Close Diffview",
      },
      {
        "<leader>gh",
        "<cmd>DiffviewFileHistory<cr>",
        desc = "File History",
      },
      {
        "<leader>gH",
        "<cmd>DiffviewFileHistory %<cr>",
        desc = "Current File History",
      },
      {
        "<leader>gF",
        "<cmd>DiffviewRefresh<cr>",
        desc = "Refresh Diffview",
      },
      {
        "<leader>gC",
        function()
          local branch = vim.fn.input("Compare with branch: ")
          if branch ~= "" then
            vim.cmd("DiffviewOpen " .. branch)
          end
        end,
        desc = "Compare with Branch",
      },
    },
  },
  {
    "lspsaga.nvim",
    for_cat = "general.core",
    on_require = { "lspsaga" },
    after = function()
      require('lspsaga').setup({
        -- UI Configuration
        ui = {
          theme = 'round',
          border = 'rounded',
          winblend = 0,
          expand = '',
          collapse = '',
          code_action = 'ðŸ’¡',
          incoming = ' ',
          outgoing = ' ',
          hover = ' ',
          kind = {},
        },
        
        -- Symbol in winbar
        symbol_in_winbar = {
          enable = true,
          separator = ' â€º ',
          hide_keyword = true,
          show_file = true,
          folder_level = 2,
          respect_root = false,
          color_mode = true,
        },
        
        -- Code action configuration
        code_action = {
          num_shortcut = true,
          show_server_name = false,
          extend_gitsigns = true,
          keys = {
            quit = "q",
            exec = "<CR>",
          },
        },
        
        -- Lightbulb for code actions
        lightbulb = {
          enable = true,
          enable_in_insert = false,
          sign = true,
          sign_priority = 40,
          virtual_text = false,
        },
        
        -- Preview definition
        preview = {
          lines_above = 0,
          lines_below = 10,
        },
        
        -- Scroll in preview
        scroll_preview = {
          scroll_down = '<C-f>',
          scroll_up = '<C-b>',
        },
        
        -- Request timeout
        request_timeout = 2000,
        
        -- Finder configuration
        finder = {
          edit = { 'o', '<CR>' },
          vsplit = 's',
          split = 'i',
          tabe = 't',
          quit = { 'q', '<ESC>' },
        },
        
        -- Definition configuration
        definition = {
          edit = '<C-c>o',
          vsplit = '<C-c>v',
          split = '<C-c>i',
          tabe = '<C-c>t',
          quit = 'q',
        },
        
        -- Rename configuration
        rename = {
          quit = '<C-c>',
          exec = '<CR>',
          mark = 'x',
          confirm = '<CR>',
          in_select = true,
        },
        
        -- Diagnostic configuration
        diagnostic = {
          on_insert = false,
          on_insert_follow = false,
          insert_winblend = 0,
          show_code_action = true,
          show_source = true,
          jump_num_shortcut = true,
          max_width = 0.7,
          custom_fix = nil,
          custom_msg = nil,
          text_hl_follow = false,
          border_follow = true,
          keys = {
            exec_action = 'o',
            quit = 'q',
            go_action = 'g'
          },
        },
        
        -- Hover configuration
        hover = {
          max_width = 0.6,
          open_link = 'gx',
          open_browser = '!chrome',
        },
        
        -- Outline configuration
        outline = {
          win_position = 'right',
          win_with = '',
          win_width = 30,
          show_detail = true,
          auto_preview = true,
          auto_refresh = true,
          auto_close = true,
          custom_sort = nil,
          keys = {
            jump = 'o',
            expand_collapse = 'u',
            quit = 'q',
          },
        },
        
        -- Callhierarchy configuration
        callhierarchy = {
          show_detail = false,
          keys = {
            edit = 'e',
            vsplit = 's',
            split = 'i',
            tabe = 't',
            jump = 'o',
            quit = 'q',
            expand_collapse = 'u',
          },
        },
        
        -- Beacon configuration for jump highlights
        beacon = {
          enable = true,
          frequency = 7,
        },
      })
    end,
    
    -- Event-based loading for LSP-related functionality
    event = "LspAttach",
    
    -- Command-based loading
    cmd = {
      "Lspsaga",
    },
    
    -- Key mappings for enhanced LSP features
    keys = {
      -- LSP finder - find the symbol's definition/references/implementation/type def/declaration
      {
        "gf",
        "<cmd>Lspsaga finder<CR>",
        desc = "LSP Finder",
      },
      -- Code action
      {
        "<leader>ca",
        "<cmd>Lspsaga code_action<CR>",
        desc = "Code Action",
      },
      -- Rename
      {
        "gr", 
        "<cmd>Lspsaga rename<CR>",
        desc = "LSP Rename",
      },
      -- Rename ++project
      {
        "gR",
        "<cmd>Lspsaga rename ++project<CR>",
        desc = "LSP Rename Project",
      },
      -- Peek definition
      {
        "gp",
        "<cmd>Lspsaga peek_definition<CR>",
        desc = "Peek Definition", 
      },
      -- Go to definition
      {
        "gd",
        "<cmd>Lspsaga goto_definition<CR>",
        desc = "Go to Definition",
      },
      -- Peek type definition
      {
        "gt",
        "<cmd>Lspsaga peek_type_definition<CR>",
        desc = "Peek Type Definition",
      },
      -- Go to type definition
      {
        "gT",
        "<cmd>Lspsaga goto_type_definition<CR>",
        desc = "Go to Type Definition",
      },
      -- Show line diagnostics
      {
        "<leader>sl",
        "<cmd>Lspsaga show_line_diagnostics<CR>",
        desc = "Show Line Diagnostics",
      },
      -- Show cursor diagnostics
      {
        "<leader>sc",
        "<cmd>Lspsaga show_cursor_diagnostics<CR>",
        desc = "Show Cursor Diagnostics",
      },
      -- Show buffer diagnostics
      {
        "<leader>sb",
        "<cmd>Lspsaga show_buf_diagnostics<CR>",
        desc = "Show Buffer Diagnostics",
      },
      -- Diagnostic jump
      {
        "[e",
        "<cmd>Lspsaga diagnostic_jump_prev<CR>",
        desc = "Previous Diagnostic",
      },
      {
        "]e", 
        "<cmd>Lspsaga diagnostic_jump_next<CR>",
        desc = "Next Diagnostic",
      },
      -- Diagnostic jump with filters such as only jumping to an error
      {
        "[E",
        function()
          require("lspsaga.diagnostic"):goto_prev({ severity = vim.diagnostic.severity.ERROR })
        end,
        desc = "Previous Error",
      },
      {
        "]E",
        function()
          require("lspsaga.diagnostic"):goto_next({ severity = vim.diagnostic.severity.ERROR })
        end,
        desc = "Next Error", 
      },
      -- Toggle outline
      {
        "<leader>o",
        "<cmd>Lspsaga outline<CR>",
        desc = "LSP Outline",
      },
      -- Hover Doc
      {
        "K",
        "<cmd>Lspsaga hover_doc<CR>",
        desc = "Hover Documentation",
      },
      -- Hover Doc ++keep to keep hover window
      {
        "<leader>K",
        "<cmd>Lspsaga hover_doc ++keep<CR>",
        desc = "Keep Hover Documentation",
      },
      -- Call hierarchy
      {
        "<Leader>ci",
        "<cmd>Lspsaga incoming_calls<CR>",
        desc = "Incoming Calls",
      },
      {
        "<Leader>co",
        "<cmd>Lspsaga outgoing_calls<CR>",
        desc = "Outgoing Calls",
      },
      -- Floating terminal
      {
        "<A-d>",
        "<cmd>Lspsaga term_toggle<CR>",
        mode = { "n", "t" },
        desc = "Toggle Terminal",
      },
    },
  },
}
